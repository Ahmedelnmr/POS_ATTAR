<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… Ù†Ù‚Ø§Ø· Ø§Ù„Ø¨ÙŠØ¹ ÙˆØ§Ù„Ù…Ø®Ø²ÙˆÙ†</title>
    <link rel="stylesheet" href="public/css/main.css?v=1771030252">
    <script src="public/js/app_core.js?v=1771030252"></script>
</head>
<body>
<div class="toast-container" id="toastContainer"></div>
<div class="app-wrapper">
    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="sidebar-logo">
            <h2>ğŸ’° POS System</h2>
            <span>Ù†Ø¸Ø§Ù… Ù†Ù‚Ø§Ø· Ø§Ù„Ø¨ÙŠØ¹ ÙˆØ§Ù„Ù…Ø®Ø²ÙˆÙ†</span>
        </div>
        <nav class="sidebar-nav">
            <a href="?page=dashboard" class="nav-item ">
                <span class="icon">ğŸ“Š</span> Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
            </a>
            <a href="?page=pos" class="nav-item ">
                <span class="icon">ğŸ›’</span> Ù†Ù‚Ø·Ø© Ø§Ù„Ø¨ÙŠØ¹
            </a>
            <a href="?page=products" class="nav-item ">
                <span class="icon">ğŸ“¦</span> Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
            </a>
            <a href="?page=suppliers" class="nav-item ">
                <span class="icon">ğŸ­</span> Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†
            </a>
            <a href="?page=purchases" class="nav-item ">
                <span class="icon">ğŸ§¾</span> Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª
            </a>
            <a href="?page=inventory" class="nav-item active">
                <span class="icon">ğŸ“‹</span> Ø§Ù„Ù…Ø®Ø²ÙˆÙ†
            </a>
            <a href="?page=sales" class="nav-item ">
                <span class="icon">ğŸ’µ</span> Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª
            </a>
            <a href="?page=reports" class="nav-item ">
                <span class="icon">ğŸ“ˆ</span> Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±
            </a>
        </nav>
        <div class="sidebar-footer">
            Ù†Ø¸Ø§Ù… Ù†Ù‚Ø§Ø· Ø§Ù„Ø¨ÙŠØ¹ v1.0 &copy; 2026        </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
<!-- Inventory View -->
<div class="page-header">
    <div>
        <h1>ğŸ“‹ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</h1>
    </div>
</div>

<!-- Summary Stats -->
<div class="stats-grid">
    <div class="stat-card">
        <div class="stat-icon blue">ğŸ“¦</div>
        <div class="stat-info">
            <h4>6</h4>
            <p>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</p>
        </div>
    </div>
    <div class="stat-card">
        <div class="stat-icon green">ğŸ’°</div>
        <div class="stat-info">
            <h4>711,355.17</h4>
            <p>Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</p>
        </div>
    </div>
    <div class="stat-card">
        <div class="stat-icon red">âš ï¸</div>
        <div class="stat-info">
            <h4>0</h4>
            <p>Ù…Ù†ØªØ¬Ø§Øª Ù…Ù†Ø®ÙØ¶Ø©</p>
        </div>
    </div>
</div>


<!-- All Products Stock -->
<div class="card">
    <div class="card-header">
        <h3>ğŸ“¦ Ù…Ø®Ø²ÙˆÙ† Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</h3>
    </div>
    
    <div style="margin-bottom:12px;">
        <form class="d-flex align-center gap-1" method="GET">
            <input type="hidden" name="page" value="inventory">
            <input type="text" name="search" class="form-control" style="max-width:300px;" placeholder="ğŸ” Ø¨Ø­Ø«..." value="">
            <button type="submit" class="btn btn-outline btn-sm">Ø¨Ø­Ø«</button>
        </form>
    </div>

    <div class="table-wrapper">
        <table>
            <thead>
                <tr>
                    <th>Ø§Ù„Ù…Ù†ØªØ¬</th>
                    <th>Ø§Ù„Ù†ÙˆØ¹</th>
                    <th>Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</th>
                    <th>Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰</th>
                    <th>Ø§Ù„Ù‚ÙŠÙ…Ø©</th>
                    <th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                </tr>
            </thead>
            <tbody>
                                <tr>
                    <td class="fw-bold">Ø§ÙˆÙƒØ³ÙŠ ØºØ³ÙŠÙ„ 25</td>
                    <td><span class="badge badge-info">weight</span></td>
                    <td>
                                                <span class="badge badge-success"><strong>7</strong> Ù„ÙØ© + <strong>5</strong> ÙƒÙŠÙ„Ùˆ</span>
                    </td>
                    <td>4.0</td>
                    <td class="text-muted">1,038.63</td>
                    <td>
                        <button 
                            class="btn btn-sm btn-outline btn-adjust" 
                            data-id="4" 
                            data-name="Ø§ÙˆÙƒØ³ÙŠ ØºØ³ÙŠÙ„ 25" 
                            data-qty="89.0"
                            style="cursor:pointer;">ğŸ“ ØªØ¹Ø¯ÙŠÙ„</button>
                        <button 
                            class="btn btn-sm btn-ghost btn-movements" 
                            data-id="4"
                            style="cursor:pointer;">ğŸ“Š Ø§Ù„Ø­Ø±ÙƒØ§Øª</button>
                    </td>
                </tr>
                                <tr>
                    <td class="fw-bold">Ø¨Ø§Ù…Ø¨Ø±Ø²</td>
                    <td><span class="badge badge-info">unit</span></td>
                    <td>
                                                <span class="badge badge-success"><strong>6</strong> Ù„ÙØ© + <strong>20</strong> Ù‚Ø·Ø¹Ø©</span>
                    </td>
                    <td>5.0</td>
                    <td class="text-muted">2,026.54</td>
                    <td>
                        <button 
                            class="btn btn-sm btn-outline btn-adjust" 
                            data-id="6" 
                            data-name="Ø¨Ø§Ù…Ø¨Ø±Ø²" 
                            data-qty="380.0"
                            style="cursor:pointer;">ğŸ“ ØªØ¹Ø¯ÙŠÙ„</button>
                        <button 
                            class="btn btn-sm btn-ghost btn-movements" 
                            data-id="6"
                            style="cursor:pointer;">ğŸ“Š Ø§Ù„Ø­Ø±ÙƒØ§Øª</button>
                    </td>
                </tr>
                                <tr>
                    <td class="fw-bold">Ø³ÙƒØ±</td>
                    <td><span class="badge badge-info">weight</span></td>
                    <td>
                                                <span class="badge badge-success"><strong>13</strong> Ø´ÙˆØ§Ù„ + <strong>6</strong> ÙƒÙŠÙ„Ùˆ</span>
                    </td>
                    <td>5.0</td>
                    <td class="text-muted">4,080.00</td>
                    <td>
                        <button 
                            class="btn btn-sm btn-outline btn-adjust" 
                            data-id="5" 
                            data-name="Ø³ÙƒØ±" 
                            data-qty="136.0"
                            style="cursor:pointer;">ğŸ“ ØªØ¹Ø¯ÙŠÙ„</button>
                        <button 
                            class="btn btn-sm btn-ghost btn-movements" 
                            data-id="5"
                            style="cursor:pointer;">ğŸ“Š Ø§Ù„Ø­Ø±ÙƒØ§Øª</button>
                    </td>
                </tr>
                                <tr>
                    <td class="fw-bold">ÙÙ„ÙÙ„ Ø£Ø³ÙˆØ¯</td>
                    <td><span class="badge badge-info">weight</span></td>
                    <td>
                                                <span class="badge badge-success"><strong>2992.6</strong></span>
                    </td>
                    <td>300.0</td>
                    <td class="text-muted">299,260.00</td>
                    <td>
                        <button 
                            class="btn btn-sm btn-outline btn-adjust" 
                            data-id="3" 
                            data-name="ÙÙ„ÙÙ„ Ø£Ø³ÙˆØ¯" 
                            data-qty="2992.6"
                            style="cursor:pointer;">ğŸ“ ØªØ¹Ø¯ÙŠÙ„</button>
                        <button 
                            class="btn btn-sm btn-ghost btn-movements" 
                            data-id="3"
                            style="cursor:pointer;">ğŸ“Š Ø§Ù„Ø­Ø±ÙƒØ§Øª</button>
                    </td>
                </tr>
                                <tr>
                    <td class="fw-bold">ÙƒÙ…ÙˆÙ† Ù…Ø·Ø­ÙˆÙ†</td>
                    <td><span class="badge badge-info">weight</span></td>
                    <td>
                                                <span class="badge badge-success"><strong>5000.0</strong></span>
                    </td>
                    <td>500.0</td>
                    <td class="text-muted">400,000.00</td>
                    <td>
                        <button 
                            class="btn btn-sm btn-outline btn-adjust" 
                            data-id="2" 
                            data-name="ÙƒÙ…ÙˆÙ† Ù…Ø·Ø­ÙˆÙ†" 
                            data-qty="5000.0"
                            style="cursor:pointer;">ğŸ“ ØªØ¹Ø¯ÙŠÙ„</button>
                        <button 
                            class="btn btn-sm btn-ghost btn-movements" 
                            data-id="2"
                            style="cursor:pointer;">ğŸ“Š Ø§Ù„Ø­Ø±ÙƒØ§Øª</button>
                    </td>
                </tr>
                                <tr>
                    <td class="fw-bold">Ù…Ù†ØªØ¬ ØªØ¬Ø±ÙŠØ¨ÙŠ - Ø¨ÙŠØ¶</td>
                    <td><span class="badge badge-info">unit</span></td>
                    <td>
                                                <span class="badge badge-success"><strong>99.0</strong></span>
                    </td>
                    <td>10.0</td>
                    <td class="text-muted">4,950.00</td>
                    <td>
                        <button 
                            class="btn btn-sm btn-outline btn-adjust" 
                            data-id="1" 
                            data-name="Ù…Ù†ØªØ¬ ØªØ¬Ø±ÙŠØ¨ÙŠ - Ø¨ÙŠØ¶" 
                            data-qty="99.0"
                            style="cursor:pointer;">ğŸ“ ØªØ¹Ø¯ÙŠÙ„</button>
                        <button 
                            class="btn btn-sm btn-ghost btn-movements" 
                            data-id="1"
                            style="cursor:pointer;">ğŸ“Š Ø§Ù„Ø­Ø±ÙƒØ§Øª</button>
                    </td>
                </tr>
                            </tbody>
        </table>
    </div>
</div>

<!-- Adjust Stock Modal -->
<div class="modal-overlay" id="adjustModal">
    <div class="modal">
        <div class="modal-header">
            <h3>ğŸ“ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</h3>
            <button class="modal-close" onclick="closeModal('adjustModal')">&times;</button>
        </div>
        <div class="modal-body">
            <p class="fw-bold mb-2" id="adjustProductName"></p>
            <div class="form-group">
                <label>Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ø­Ø§Ù„ÙŠØ©</label>
                <input type="text" class="form-control" id="adjustCurrentQty" readonly>
            </div>
            <div class="form-group">
                <label>Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©</label>
                <input type="number" class="form-control" id="adjustNewQty" step="0.01">
            </div>
            <div class="form-group">
                <label>Ø§Ù„Ø³Ø¨Ø¨</label>
                <input type="text" class="form-control" id="adjustReason" placeholder="Ø³Ø¨Ø¨ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„">
            </div>
            <input type="hidden" id="adjustProductId">
        </div>
        <div class="modal-footer">
            <button class="btn btn-outline" onclick="closeModal('adjustModal')">Ø¥Ù„ØºØ§Ø¡</button>
            <button class="btn btn-primary" onclick="saveAdjustment()">ğŸ’¾ Ø­ÙØ¸</button>
        </div>
    </div>
</div>

<!-- Movements Modal -->
<div class="modal-overlay" id="movementsModal">
    <div class="modal" style="max-width:700px;">
        <div class="modal-header">
            <h3>ğŸ“Š Ø­Ø±ÙƒØ§Øª Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</h3>
            <button class="modal-close" onclick="closeModal('movementsModal')">&times;</button>
        </div>
        <div class="modal-body" id="movementsContent">
            <div class="spinner"></div>
        </div>
    </div>
</div>

<script>
// Ensure modal functions exist (fallback if app_core.js fails)
if (typeof openModal === 'undefined') {
    window.openModal = function(modalId) {
        console.log('ğŸ”“ Opening modal:', modalId);
        const modal = document.getElementById(modalId);
        if (modal) {
            modal.classList.add('active');
            console.log('âœ… Modal opened');
        } else {
            console.error('âŒ Modal not found:', modalId);
        }
    };
}

if (typeof closeModal === 'undefined') {
    window.closeModal = function(modalId) {
        console.log('ğŸ”’ Closing modal:', modalId);
        const modal = document.getElementById(modalId);
        if (modal) modal.classList.remove('active');
    };
}

if (typeof apiRequest === 'undefined') {
    window.apiRequest = async function(url, options = {}) {
        console.log('ğŸ“¡ API Request:', url);
        try {
            const defaultOptions = {
                headers: {
                    'Content-Type': 'application/json',
                    'X-Requested-With': 'XMLHttpRequest'
                }
            };
            if (options.body && typeof options.body === 'object') {
                options.body = JSON.stringify(options.body);
            }
            const response = await fetch(url, { ...defaultOptions, ...options });
            return await response.json();
        } catch (error) {
            console.error('API Error:', error);
            return { success: false, message: 'Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„' };
        }
    };
}

function openAdjustModal(id, name, currentQty) {
    console.log('ğŸ–±ï¸ Button clicked - openAdjustModal:', {id, name, currentQty});
    document.getElementById('adjustProductId').value = id;
    document.getElementById('adjustProductName').textContent = name;
    document.getElementById('adjustCurrentQty').value = currentQty;
    document.getElementById('adjustNewQty').value = currentQty;
    openModal('adjustModal');
}

// Attach event listeners to all buttons
document.addEventListener('DOMContentLoaded', function() {
    console.log('âœ… Page loaded - attaching event listeners');
    
    // Adjust buttons
    var adjustButtons = document.querySelectorAll('.btn-adjust');
    for (var i = 0; i < adjustButtons.length; i++) {
        adjustButtons[i].addEventListener('click', function() {
            console.log('ğŸ–±ï¸ Adjust button clicked!');
            var id = this.dataset.id;
            var name = this.dataset.name;
            var qty = this.dataset.qty;
            openAdjustModal(id, name, qty);
        });
    }
    
    // Movements buttons
    var movementButtons = document.querySelectorAll('.btn-movements');
    for (var j = 0; j < movementButtons.length; j++) {
        movementButtons[j].addEventListener('click', function() {
            console.log('ğŸ–±ï¸ Movements button clicked!');
            var id = this.dataset.id;
            viewMovements(id);
        });
    }
    
    console.log('âœ… Event listeners attached:', {
        adjustButtons: adjustButtons.length,
        movementButtons: movementButtons.length
    });
});

function saveAdjustment() {
    console.log('ğŸ’¾ Saving adjustment...');
    var productId = document.getElementById('adjustProductId').value;
    var newQty = parseFloat(document.getElementById('adjustNewQty').value);
    var reason = document.getElementById('adjustReason').value;

    apiRequest('?page=inventory&action=adjust', {
        method: 'POST',
        body: { product_id: productId, new_quantity: newQty, reason: reason }
    }).then(function(res) {
        if (res.success) {
            if (typeof showToast !== 'undefined') {
                showToast('âœ… ØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†');
            } else {
                alert('âœ… ØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†');
            }
            closeModal('adjustModal');
            setTimeout(function() { location.reload(); }, 500);
        } else {
            if (typeof showToast !== 'undefined') {
                showToast(res.message || 'Ø®Ø·Ø£', 'error');
            } else {
                alert(res.message || 'Ø®Ø·Ø£');
            }
        }
    });
}

function viewMovements(productId) {
    console.log('ğŸ–±ï¸ Button clicked - viewMovements:', productId);
    openModal('movementsModal');
    var content = document.getElementById('movementsContent');
    content.innerHTML = '<div class="spinner"></div>';

    apiRequest('?page=inventory&action=movements&product_id=' + productId).then(function(res) {
        if (res.success && res.data && res.data.length > 0) {
            var typeLabels = { purchase: 'ğŸŸ¢ Ø´Ø±Ø§Ø¡', sale: 'ğŸ”´ Ø¨ÙŠØ¹', adjustment: 'ğŸŸ¡ ØªØ¹Ø¯ÙŠÙ„' };
            var rows = '';
            for (var i = 0; i < res.data.length; i++) {
                var m = res.data[i];
                var colorClass = m.quantity >= 0 ? 'text-success' : 'text-danger';
                var sign = m.quantity >= 0 ? '+' : '';
                rows += '<tr>' +
                    '<td class="fs-sm">' + m.created_at + '</td>' +
                    '<td>' + (typeLabels[m.type] || m.type) + '</td>' +
                    '<td class="' + colorClass + ' fw-bold">' + sign + m.quantity + '</td>' +
                    '<td class="text-muted fs-sm">' + (m.notes || 'â€”') + '</td>' +
                    '</tr>';
            }
            content.innerHTML = '<div class="table-wrapper">' +
                '<table>' +
                '<thead><tr><th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th><th>Ø§Ù„Ù†ÙˆØ¹</th><th>Ø§Ù„ÙƒÙ…ÙŠØ©</th><th>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th></tr></thead>' +
                '<tbody>' + rows + '</tbody>' +
                '</table></div>';
        } else {
            content.innerHTML = '<div class="empty-state"><p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ø±ÙƒØ§Øª</p></div>';
        }
    });
}
</script>
    </main>
</div>
<!-- App JS -->
<!-- App JS -->

</body>
</html>
